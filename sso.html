<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="referrer" content="no-referrer" />
  <title>EazyCare | กำลังเข้าสู่ระบบ…</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font:15px/1.5 system-ui,-apple-system,"Segoe UI",Roboto;margin:0}
    #sso-wrap{max-width:520px;margin:40px auto;padding:0 14px;text-align:center}
    .muted{color:#6b7280}
  </style>
</head>
<body>
  <div id="sso-wrap">
    <h3>กำลังเข้าสู่ระบบ...</h3>
    <p id="sso-msg" class="muted">โปรดรอสักครู่</p>
  </div>
  <script>
  (async function(){
    const LIFF_ID      = '2008100293-QNl6ParD';
    const REDIRECT_URL = 'https://www.eazycare.in.th/check-warranty/';
    const BRIDGE_URL   = 'https://www.eazycare.in.th/wp-admin/admin-post.php?action=ec_liff_sso';
    const say = (t)=> (document.getElementById('sso-msg').textContent = t);

    try{ await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true }); }
    catch(e){ say('เริ่ม LIFF ไม่สำเร็จ'); return; }
    if (!liff.isLoggedIn()) { liff.login({ redirectUri: location.href }); return; }

    const idToken = liff.getIDToken();
    if (!idToken){ say('ไม่พบ id_token (ตรวจ scope: openid)'); return; }

    // ให้ WP ตั้งคุกกี้โดยตรง (top-level redirect)
    const url = BRIDGE_URL + '&id_token=' + encodeURIComponent(idToken) +
                '&redir=' + encodeURIComponent(REDIRECT_URL);
    say('กำลังเชื่อมต่อ...');
    location.replace(url);
  })();
  </script>
</body>
</html>
